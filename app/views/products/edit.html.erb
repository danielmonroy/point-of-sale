<!--begin::Toolbar-->
<div id="kt_app_toolbar" class="app-toolbar py-3 py-lg-6">
  <!--begin::Toolbar container-->
  <div id="kt_app_toolbar_container" class="app-container container-xxl d-flex flex-stack">
    <!--begin::Page title-->
    <div class="page-title d-flex flex-column justify-content-center flex-wrap me-3">
      <!--begin::Title-->
      <h1 class="page-heading d-flex text-dark fw-bold fs-3 flex-column justify-content-center my-0"><%= @product.name %></h1>
      <!--end::Title-->
      <!--begin::Breadcrumb-->
      <ul class="breadcrumb breadcrumb-separatorless fw-semibold fs-7 my-0 pt-1">
        <!--begin::Item-->
        <li class="breadcrumb-item text-muted">
          <a href="#" class="text-muted text-hover-primary">Administración</a>
        </li>
        <!--end::Item-->
      </ul>
      <!--end::Breadcrumb-->
    </div>
    <!--end::Page title-->
  </div>
  <!--end::Toolbar container-->
</div>
<!--end::Toolbar-->
<!--begin::Content-->
<div id="kt_app_content" class="app-content flex-column-fluid">
  <!--begin::Content container-->
  <div id="kt_app_content_container" class="app-container container-xxl">
    <!--begin::Form-->
    <%= form_with(model: @product, class: "form d-flex flex-column flex-lg-row") do |form| %>
      <!--begin::Aside column-->
      <div class="d-flex flex-column gap-7 gap-lg-10 w-100 w-lg-300px mb-7 me-lg-10">
        <!--begin::Thumbnail settings-->
        <div class="card card-flush py-4">
          <!--begin::Card header-->
          <div class="card-header">
            <!--begin::Card title-->
            <div class="card-title">
              <h2>Imagen de Producto</h2>
            </div>
            <!--end::Card title-->
          </div>
          <!--end::Card header-->
          <!--begin::Card body-->
          <div class="card-body text-center pt-0">
            <!--begin::Image input-->
            <div class="image-input image-input-empty image-input-outline image-input-placeholder mb-3" data-kt-image-input="true">
              <!--begin::Preview existing avatar-->
              <div class="image-input-wrapper w-150px h-150px" style="background-image: url(<%= url_for(@product.image) unless @product.image.blank? %>)"></div>
              <!--end::Preview existing avatar-->
              <!--begin::Label-->
              <label class="btn btn-icon btn-circle btn-active-color-primary w-25px h-25px bg-body shadow" data-kt-image-input-action="change" data-bs-toggle="tooltip" title="Change avatar">
                <i class="ki-duotone ki-pencil fs-7">
                  <span class="path1"></span>
                  <span class="path2"></span>
                </i>
                <!--begin::Inputs-->
                <%= form.file_field :image, accept: "image/png,image/jpg,image/jpeg" %>
                <input type="hidden" name="avatar_remove" />
                <!--end::Inputs-->
              </label>
              <!--end::Label-->
              <!--begin::Cancel-->
              <span class="btn btn-icon btn-circle btn-active-color-primary w-25px h-25px bg-body shadow" data-kt-image-input-action="cancel" data-bs-toggle="tooltip" title="Cancel avatar">
                <i class="ki-duotone ki-cross fs-2">
                  <span class="path1"></span>
                  <span class="path2"></span>
                </i>
              </span>
              <!--end::Cancel-->
              <!--begin::Remove-->
              <span class="btn btn-icon btn-circle btn-active-color-primary w-25px h-25px bg-body shadow" data-kt-image-input-action="remove" data-bs-toggle="tooltip" title="Remove avatar">
                <i class="ki-duotone ki-cross fs-2">
                  <span class="path1"></span>
                  <span class="path2"></span>
                </i>
              </span>
              <!--end::Remove-->
            </div>
            <!--end::Image input-->
          </div>
          <!--end::Card body-->
        </div>
        <!--end::Thumbnail settings-->
        <!--begin::Status-->
        <div class="card card-flush py-4">
          <!--begin::Card header-->
          <div class="card-header">
            <!--begin::Card title-->
            <div class="card-title">
              <h2>Disponibilidad</h2>
            </div>
            <!--end::Card title-->
          </div>
          <!--end::Card header-->
          <!--begin::Card body-->
          <div class="card-body pt-0">
            <!--begin::Select2-->
            <%= form.select(:available, options_for_select([["Activo", true], ["Inactivo", false]], @product.available), {}, { class: "form-select mb-2", data: { control: "select2", "hide-search": true } }) %>
            <!--end::Select2-->
          </div>
          <!--end::Card body-->
        </div>
        <!--end::Status-->
        <!--begin::Category & tags-->
        <div class="card card-flush py-4">
          <!--begin::Card header-->
          <div class="card-header">
            <!--begin::Card title-->
            <div class="card-title">
              <h2>Detalles de Producto</h2>
            </div>
            <!--end::Card title-->
          </div>
          <!--end::Card header-->
          <!--begin::Card body-->
          <div class="card-body pt-0">
            <!--begin::Input group-->
            <!--begin::Label-->
            <label class="form-label">Categoría</label>
            <!--end::Label-->
            <!--begin::Select2-->
            <%= form.select(:category_id, @categories.collect { |c| [c.name, c.id] }, {}, { class: "form-select mb-2", data: { control: "select2", "hide-search": true } }) %>
            <!--end::Select2-->
            <!--end::Input group-->
            <!--begin::Input group-->
            <!--begin::Label-->
            <label class="form-label d-block pt-10">Estación de trabajo</label>
            <!--end::Label-->
            <!--begin::Input-->
            <%= form.select(:working_station_id, @working_stations.collect { |c| [c.name, c.id] }, {}, { class: "form-select mb-2", data: { control: "select2", "hide-search": true } }) %>
            <!--end::Input-->
            <!--end::Input group-->
          </div>
          <!--end::Card body-->
        </div>
        <!--end::Category & tags-->
      </div>
      <!--end::Aside column-->
      <!--begin::Main column-->
      <div class="d-flex flex-column flex-row-fluid gap-7 gap-lg-10">
        <!--begin::Tab content-->
        <div class="tab-content">
          <!--begin::Tab pane-->
          <div class="tab-pane fade show active" id="kt_ecommerce_add_product_general" role="tab-panel">
            <div class="d-flex flex-column gap-7 gap-lg-10">
              <!--begin::General options-->
              <div class="card card-flush py-4">
                <!--begin::Card header-->
                <div class="card-header">
                  <div class="card-title">
                    <h2>General</h2>
                  </div>
                </div>
                <!--end::Card header-->
                <!--begin::Card body-->
                <div class="card-body pt-0">
                  <!--begin::Input group-->
                  <div class="mb-10 fv-row">
                    <!--begin::Label-->
                    <label class="required form-label">Nombre de Producto</label>
                    <!--end::Label-->
                    <!--begin::Input-->
                    <%= form.text_field :name, class: "form-control mb-2" %>
                    <!--end::Input-->
                  </div>
                  <!--end::Input group-->
                  <!--begin::Input group-->
                  <div class="fv-row">
                    <!--begin::Label-->
                    <label class="required form-label">Precio</label>
                    <!--end::Label-->
                    <!--begin::Input-->
                    <%= form.number_field :price, class: "form-control mb-2" %>
                    <!--end::Input-->
                  </div>
                  <!--end::Input group-->
                </div>
                <!--end::Card header-->
              </div>
              <!--end::General options-->
              <!--begin::Product Item options-->
              <div class="card card-flush py-4">
                <!--begin::Card header-->
                <div class="card-header">
                  <div class="card-title">
                    <h2>Ingredientes</h2>
                  </div>
                </div>
                <!--end::Card header-->
                <!--begin::Card body-->
                <div class="card-body pt-0">
                  <!--begin::Table container-->
                  <div class="table-responsive">
                    <!--begin::Table-->
                    <table class="table table-row-dashed table-row-gray-300 align-middle gs-0 gy-4">
                      <!--begin::Table head-->
                      <thead>
                        <tr class="border-0">
                          <th class="p-0">Insumo</th>
                          <th class="p-0">Cantidad</th>
                        </tr>
                      </thead>
                      <!--end::Table head-->
                      <!--begin::Table body-->
                      <tbody>
                        <% @product.product_items.each do |pi| %>
                        <tr>
                          <td><%= pi.item.name %> </td>
                          <td><%= "#{pi.quantity} #{pi.item.measurement_unit}" %></td>
                        </tr>
                        <% end %>
                      </tbody>
                      <!--end::Table body-->
                    </table>
                    <!--end::Table-->
                  </div>
                  <!--end::Table container-->
                  <!--begin::Button-->
                  <button type="button" class="btn btn-light-info me-5" data-bs-toggle="modal" data-bs-target="#kt_modal_new_product_item">
                  <i class="ki-duotone ki-plus-square fs-3">
                    <span class="path1"></span>
                    <span class="path2"></span>
                    <span class="path3"></span>
                  </i>Agregar ingrediente</button>
                  <!--end::Button-->
                  <!--begin::Button-->
                  <button type="button" class="btn btn-light-danger me-5" data-bs-toggle="modal" data-bs-target="#kt_modal_remove_product_item">
                  <i class="ki-duotone ki-cross-square fs-3">
                    <span class="path1"></span>
                    <span class="path2"></span>
                  </i>Eliminar ingrediente</button>
                  <!--end::Button-->
                </div>
                <!--end::Card header-->
              </div>
              <!--end::Product Item options-->
            </div>
          </div>
          <!--end::Tab pane-->
        </div>
        <!--end::Tab content-->
        <div class="d-flex justify-content-end">
          <!--begin::Button-->
          <%= link_to "Cancelar", products_path, class: "btn btn-light me-5" %>
          <!--end::Button-->
          <!--begin::Button-->
          <button type="submit" id="kt_ecommerce_add_product_submit" class="btn btn-primary">
            <span class="indicator-label">Guardar</span>
            <span class="indicator-progress">Espera...
            <span class="spinner-border spinner-border-sm align-middle ms-2"></span></span>
          </button>
          <!--end::Button-->
        </div>
      </div>
      <!--end::Main column-->
    <% end %>
    <!--end::Form-->
  </div>
  <!--end::Content container-->
</div>
<!--end::Content-->

<!--begin::Modal - New Product Item-->
<div class="modal fade" id="kt_modal_new_product_item" tabindex="-1" aria-hidden="true">
  <!--begin::Modal dialog-->
  <div class="modal-dialog modal-dialog-centered mw-650px">
    <!--begin::Modal content-->
    <div class="modal-content">
      <!--begin::Form-->
      <%= form_with scope: :product_item, url: "/products/add_product_items", method: :post do |form| %>
        <!--begin::Modal header-->
        <div class="modal-header" id="kt_modal_new_item_header">
          <!--begin::Modal title-->
          <h2>Agregar Ingrediente</h2>
          <!--end::Modal title-->
          <!--begin::Close-->
          <div class="btn btn-sm btn-icon btn-active-color-primary" data-bs-dismiss="modal">
            <i class="ki-duotone ki-cross fs-1">
              <span class="path1"></span>
              <span class="path2"></span>
            </i>
          </div>
          <!--end::Close-->
        </div>
        <!--end::Modal header-->
        <!--begin::Modal body-->
        <div class="modal-body py-10 px-lg-17">
          <!--begin::Scroll-->
          <div class="scroll-y me-n7 pe-7" id="kt_modal_new_item_scroll" data-kt-scroll="true" data-kt-scroll-activate="{default: false, lg: true}" data-kt-scroll-max-height="auto" data-kt-scroll-dependencies="#kt_modal_new_item_header" data-kt-scroll-wrappers="#kt_modal_new_item_scroll" data-kt-scroll-offset="300px">
            <!--begin::Input group-->
            <div class="d-flex flex-column mb-5 fv-row">
              <!--begin::Label-->
              <label class="required fs-5 fw-semibold mb-2">Insumo</label>
              <!--end::Label-->
              <!--begin::Select2-->
              <%= form.select(:item_id, @items.collect {|i| [ "#{i.name.capitalize} (#{i.measurement_unit})", i.id ] }, { include_blank: true }, { class: "form-select mb-2", data: { control: "select2", placeholder: "Selecciona un insumo" } }) %>
              <!--end::Select2-->
            </div>
            <!--end::Input group-->
            <!--begin::Input group-->
            <div class="d-flex flex-column mb-5 fv-row">
              <!--begin::Label-->
              <label class="required fs-5 fw-semibold mb-2">Cantidad</label>
              <!--end::Label-->
              <!--begin::Input-->
              <%= form.number_field :quantity, class: "form-control form-control-solid" %>
              <!--end::Input-->
            </div>
            <!--end::Input group-->
            <%= form.hidden_field :product_id, value: @product.id %>
          </div>
          <!--end::Scroll-->
        </div>
        <!--end::Modal body-->
        <!--begin::Modal footer-->
        <div class="modal-footer flex-center">
          <!--begin::Button-->
          <button type="reset" id="kt_modal_new_working_station_cancel" class="btn btn-light me-3" data-bs-dismiss="modal">Cancelar</button>
          <!--end::Button-->
          <!--begin::Button-->
          <button type="submit" id="kt_modal_new_working_station_submit" class="btn btn-primary">
            <span>Guardar</span>
          </button>
          <!--end::Button-->
        </div>
        <!--end::Modal footer-->
      <% end %>
      <!--end::Form-->
    </div>
  </div>
</div>
<!--end::Modal - New Product Item-->

<!--begin::Modal - Remove Product Item-->
<div class="modal fade" id="kt_modal_remove_product_item" tabindex="-1" aria-hidden="true">
  <!--begin::Modal dialog-->
  <div class="modal-dialog modal-dialog-centered mw-650px">
    <!--begin::Modal content-->
    <div class="modal-content">
      <!--begin::Modal header-->
      <div class="modal-header" id="kt_modal_new_item_header">
        <!--begin::Modal title-->
        <h2>Eliminar Ingrediente</h2>
        <!--end::Modal title-->
        <!--begin::Close-->
        <div class="btn btn-sm btn-icon btn-active-color-primary" data-bs-dismiss="modal">
          <i class="ki-duotone ki-cross fs-1">
            <span class="path1"></span>
            <span class="path2"></span>
          </i>
        </div>
        <!--end::Close-->
      </div>
      <!--end::Modal header-->
      <!--begin::Modal body-->
      <div class="modal-body py-10 px-lg-17">
        <!--begin::Scroll-->
        <div class="scroll-y me-n7 pe-7" id="kt_modal_new_item_scroll" data-kt-scroll="true" data-kt-scroll-activate="{default: false, lg: true}" data-kt-scroll-max-height="auto" data-kt-scroll-dependencies="#kt_modal_new_item_header" data-kt-scroll-wrappers="#kt_modal_new_item_scroll" data-kt-scroll-offset="300px">
          <!--begin::Table container-->
          <div class="table-responsive">
            <!--begin::Table-->
            <table class="table table-row-dashed table-row-gray-300 align-middle gs-0 gy-4">
              <!--begin::Table head-->
              <thead>
                <tr class="border-0">
                  <th class="p-0">Insumo</th>
                  <th class="p-0">Cantidad</th>
                  <th></th>
                </tr>
              </thead>
              <!--end::Table head-->
              <!--begin::Table body-->
              <tbody>
                <% @product.product_items.each do |pi| %>
                <tr>
                  <td><%= pi.item.name %> </td>
                  <td><%= "#{pi.quantity} #{pi.item.measurement_unit}" %></td>
                  <td>
                    <%= button_to destroy_product_item_products_path(product_item_id: pi.id), method: :delete, class: "btn btn-icon btn-bg-light btn-active-color-danger btn-sm" do %>
                      <i class="ki-duotone ki-trash fs-2">
                        <span class="path1"></span>
                        <span class="path2"></span>
                        <span class="path3"></span>
                        <span class="path4"></span>
                        <span class="path5"></span>
                      </i>
                    <% end %>
                  </td>
                </tr>
                <% end %>
              </tbody>
              <!--end::Table body-->
            </table>
            <!--end::Table-->
          </div>
          <!--end::Table container-->
        </div>
        <!--end::Scroll-->
      </div>
      <!--end::Modal body-->
      <!--begin::Modal footer-->
      <div class="modal-footer flex-center">
        <!--begin::Button-->
        <button type="reset" id="kt_modal_new_working_station_cancel" class="btn btn-light me-3" data-bs-dismiss="modal">Cancelar</button>
        <!--end::Button-->
      </div>
      <!--end::Modal footer-->
    </div>
  </div>
</div>
<!--end::Modal - Remove Product Item-->